(function(){"use strict";var De=Object.defineProperty;var xe=(b,y,v)=>y in b?De(b,y,{enumerable:!0,configurable:!0,writable:!0,value:v}):b[y]=v;var g=(b,y,v)=>(xe(b,typeof y!="symbol"?y+"":y,v),v);const b=(n,e,t)=>{const i=new Date;i.setTime(i.getTime()+t*24*60*60*1e3);let s="expires="+i.toUTCString();document.cookie=n+"="+e+";"+s+";path=/;SameSite=None;Secure"},y=n=>{let e=n+"=",t=document.cookie.split(";");for(let i=0;i<t.length;i++){let s=t[i];for(;s.charAt(0)==" ";)s=s.substring(1);if(s.indexOf(e)==0)return s.substring(e.length,s.length)}return""},v=n=>{document.cookie=n+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"},x=()=>window.matchMedia("(max-width: 767px)").matches,F=(n,e)=>{const t=document.querySelector(`#${n}`);if(t){const i=t.src;return new URL(i).searchParams.get(e)||null}else return te("chatway.app",e)},te=(n,e)=>{const t=document.getElementsByTagName("script");for(let i=0;i<t.length;i++){let s=t[i].src;if(s&&s.includes(n))return new URL(s).searchParams.get(e)||null}return null},ie=(n,e,t)=>{let i,s,r,o=!1;if(n){const l=n.split(/\s+/);for(r=0;r<l.length;r+=1)if(i=new RegExp(`\\b${l[r]}\\b`,"g"),s=new RegExp(` *${l[r]}\\b`,"g"),e==="remove")t.className=t.className.replace(s,"");else if(e==="toggle")t.className=t.className.match(i)?t.className.replace(s,""):`${t.className} ${l[r]}`;else if(e==="has"&&t.className.match(i)){o=!0;break}}return o},V=(n,e)=>{e&&(n.className+=` ${e}`)},j=(n,e)=>{ie(e,"remove",n)},h=n=>document.querySelector(n),z=n=>document.querySelectorAll(n),se=()=>{const n=document.createElement("link");n.rel="stylesheet",n.href="https://cdn.chatway.app/sdk.css",n.id="chatway-widget-css",document.head.appendChild(n)},J=(n,e)=>{switch(n){case"s":return 44;case"m":return 60;case"l":return 70;case"xl":return 84;case"xxl":return 94;case"custom":return e?Number(e):60;default:return 60}},O=n=>{var e;return((e=[{color:"#0446DE",hex:"#0446DE"},{color:"linear-gradient(100.96deg, #43cea2 0%, #185a9d 100%), #414141",hex:"#185A9D"},{color:"#282D3E",hex:"#282D3E"},{color:"linear-gradient(101.04deg, #56CCF2 0.59%, #2F80ED 100%), #7E8E9C",hex:"#2F80ED"},{color:"linear-gradient(101.04deg, #00317A 0.59%, #001F4F 100%)",hex:"#001F4F"},{color:"linear-gradient(100.96deg, #5E3D86 0%, #2F164D 100%), #537EE1",hex:"#2F164D"},{color:"linear-gradient(180deg, #F69D01 0%, #F65901 100%)",hex:"#F65901"},{color:"linear-gradient(100.96deg, #6A3093 0%, #A044FF 100%), #3B9488",hex:"#A044FF"},{color:"linear-gradient(100.96deg, #E96443 0%, #904E95 100%), #5BB055",hex:"#904E95"}].find(t=>t.color.includes(n)))==null?void 0:e.hex)||n},ae=(n=100)=>new Promise(e=>setTimeout(e,n)),ne=()=>{const n=document.activeElement;n&&n.blur()},re=()=>{const n=document.querySelector("body"),e=window.getComputedStyle(n);sessionStorage.setItem("_bdyF",e.getPropertyValue("overflow")),document.body.style.overflow="hidden"},oe=()=>{const n=sessionStorage.getItem("_bdyF")||"auto";document.body.style.overflow=n,sessionStorage.removeItem("_bdyF")},ce=n=>{const e=window.location.search;return new URLSearchParams(e).get(n)},le=function(n){const e="֑-߿‏‫‮יִ-﷽ﹰ-ﻼ";try{return new RegExp("^[^"+e+"]*?["+e+"]").test(n)}catch{return!1}},P=n=>n?n.replace(/[^\p{L}0-9\s]/gu,"").match(/(^\S\S?|\s\S)?/g).map(e=>e.trim()).join("").match(/(^\S|\S$)?/g).join("").toLocaleUpperCase():"",H=n=>n.trim().split(`
`).reduce(function(e,t){return t=t.split("="),e[t[0]]=t[1],e},{}),R=()=>{var n,e;return window.Shopify?"shopify":(e=(n=document.querySelector("meta[name='generator']"))==null?void 0:n.getAttribute("content"))!=null&&e.toLowerCase().includes("wix")?"wix":""},A=()=>window.location.origin;class a{}g(a,"widgetID"),g(a,"userID"),g(a,"triggerData"),g(a,"appContainer"),g(a,"frameContainer"),g(a,"triggerContainer"),g(a,"iconToggler"),g(a,"agents",null),g(a,"allAgents",null),g(a,"previewText",null),g(a,"status","online"),g(a,"unReadCount",0),g(a,"pageTitle",""),g(a,"fallbackAvatar","https://prod-chaty-uploads.s3.us-west-2.amazonaws.com/npgRZqDneIU48ejuo2VR9TK13Lu40mnVdoOGA59Jj3P5VgT140758.svg"),g(a,"agentMessage",null),g(a,"hasAlreadyLoaded",!1),g(a,"token",""),g(a,"isChatInitialized",""),g(a,"visibilityHourTimezone",""),g(a,"visibilityHours",[]),g(a,"isWidgetVisible",!1),g(a,"widgetTriggers",{is_trigger_enabled:!1,has_display_after_time:!1,display_after_time:0,has_display_page_scroll:!1,display_page_scroll:0}),g(a,"pageRules"),g(a,"isHideChatwayIcon"),g(a,"previewTextBubbleDelay",0),g(a,"chatContactId",""),g(a,"browserData");class p{constructor(){}getSessionToken(){const e=a.userID;return y(`ch_cw_token_${e}`)||a.token||""}setSessionToken(e){const t=a.userID;b(`ch_cw_token_${t}`,e,365)}getChatInitStatus(){const e=a.userID;return y(`ch_cw_status_${e}`)||a.isChatInitialized||"false"}setChatInitStatus(e){const t=a.userID;b(`ch_cw_status_${t}`,e,365)}setWidgetStatus(e){const t=this.getUserConfig();t.widgetStatus=e?"open":"close",this.setUserConfig(t)}setTextBubbleStatus(e){const t=this.getUserConfig();t.hasOpenedTextBubble=e,this.setUserConfig(t)}setShowAttentionEffect(e){const t=a.userID;b(`ch_cw_shw_atn_efct_${t}`,e?"true":"false",1)}getShowAttentionEffect(){const e=a.userID;return y(`ch_cw_shw_atn_efct_${e}`)!=="false"}getUserConfig(){const e=a.userID;return JSON.parse(sessionStorage.getItem(`ch_session_info_${e}`)||"{}")}setUserConfig(e){const t=a.userID;sessionStorage.setItem(`ch_session_info_${t}`,JSON.stringify(e))}deleteUserConfig(){const e=a.userID;sessionStorage.removeItem(`ch_session_info_${e}`),sessionStorage.removeItem(`ch_cw_status_${e}`),sessionStorage.removeItem(`ch_cw_token_${e}`),v(`ch_cw_status_${e}`),v(`ch_cw_token_${e}`)}setBubbleExpiration(){let e={data:"false",expireTime:Date.now()+36e5};localStorage.setItem("showTextBubble",JSON.stringify(e))}get wasWidgetOpen(){return this.getUserConfig().widgetStatus==="open"}get hasShownTextBubble(){return!!this.getUserConfig().hasOpenedTextBubble}get showTextBubble(){const e=localStorage.getItem("showTextBubble");if(e){let t=JSON.parse(e);return t.expireTime<=Date.now()?(localStorage.removeItem("showTextBubble"),null):t.data?t.data:"true"}return null}}class _{constructor(){g(this,"triggerData");this.triggerData=a.triggerData}getCalculatedWidgetHeight(e){const t=window.innerHeight,i=704,s=400,r=t-e-104,o=Math.max(s,r);return Math.min(o,i)}async makeAppContainer(){let e;if(e=document.getElementsByTagName("body")[0],e||(await new Promise(r=>setTimeout(r,1e3)),e=document.body),!e)return;const t=document.createElement("div");t.classList.add("chatway--container");const i=document.createElement("div");i.classList.add("chatway--frame-container");const s=document.createElement("div");if(s.classList.add("chatway--trigger-container"),t.appendChild(i),t.appendChild(s),this.triggerData.default_state=="opened"&&!localStorage.getItem("showTextBubble")&&!x()&&(t.classList.add("widget--open"),e&&e.classList.add("chatway-is-open")),this.triggerData.position=="left"&&t.classList.add("widget--left"),this.triggerData.position=="custom"){this.triggerData.custom_position_side=="left"&&t.classList.add("widget--left");const r=this.getCalculatedWidgetHeight(this.triggerData.bottom_spacing),o=document.createElement("style");o.innerHTML="@media screen and (min-width: 601px) { .custom-position-widget-height .chatway--frame-container{ height: min("+r+"px,100% - 104px); }}",document.head.appendChild(o),t.classList.add("custom-position-widget-height")}return e.appendChild(t),t}makeTriggerContainer(){const e=h(".chatway--trigger-container"),t=document.createElement("div");t.id="chatway_widget_trigger",t.classList.add("chatway--trigger-icon-container");const i=J(this.triggerData.widget_size,this.triggerData.custom_widget_size);return t.style.width=`${i}px`,t.style.height=`${i}px`,this.setPosition(e),e.appendChild(t),t}makeFrameContainer(){const e=a.widgetID,i=`https://widget.chatway.app/?userId=${a.userID}&widgetId=${e}&bg-color=${this.triggerData.widget_color}`;if(h(".chatway--widget-frame"))return null;const s=h(".chatway--frame-container"),r=document.createElement("iframe");return r.classList.add("chatway--widget-frame"),r.src=i,r.id="chatway_widget_app",r.title="Live chat widget",this.setPosition(s),s.appendChild(r),s}setPosition(e){const t=J(this.triggerData.widget_size,this.triggerData.custom_widget_size),i=10,s=20,r=10;let o=this.triggerData.bottom_spacing;if(e.classList.contains("chatway--frame-container"))if(this.triggerData.position=="custom"){o=t+i+Number(this.triggerData.bottom_spacing);const c=this.getCalculatedWidgetHeight(o),d=o+c;if(d>window.innerHeight){const w=d-window.innerHeight+r;o=o-w}}else o=t+i+s;if(e.classList.contains("chatway--trigger-container"))if(this.triggerData.position=="custom"){o=Number(this.triggerData.bottom_spacing);const c=this.getCalculatedWidgetHeight(o),d=o+c;if(d>window.innerHeight){const w=d-window.innerHeight;o=o-w-t-s}}else o=s;const l=window.innerWidth;if(this.triggerData.position=="custom"){e.style.left="unset",e.style.right="unset";let c=this.triggerData.side_spacing;if(l>=480){const d=l-420;c>d&&(c=d)}else{const d=l-70;c>d&&(c=d)}c<0&&(c=0),this.triggerData.custom_position_side=="left"?e.style.left=`${c}px`:e.style.right=`${c}px`}e.classList.contains("chatway--frame-container")&&l<=600&&(e.style.left="unset",e.style.right="unset"),e.style.bottom=`${o}px`}destroyAppContainer(){const e=h(".chatway--container"),t=h("#chatway-widget-css");e==null||e.remove(),t==null||t.remove()}get isWidgetVisible(){var e;return(e=a.appContainer)==null?void 0:e.classList.contains("widget--open")}}class L{makeMultipePreviewContainer(){let e=h(".chatway--preview-container");e||(e=document.createElement("div"),e.classList.add("chatway--preview-container"));const t=h(".chatway--trigger-container"),i=this.makeCloseIcon(),s=this.makeMultipleTextBubbleContainer(),r=this.makeMessagePreviewContainer();return e.innerHTML=`
      ${i.outerHTML}
      ${s.outerHTML}
      ${r.outerHTML}
    `,t.appendChild(e),e.addEventListener("click",o=>{this.executePreviewContainerClick(o)}),e}makeSinglePreviewContainer(){let e=h(".chatway--preview-container");e||(e=document.createElement("div"),e.classList.add("chatway--preview-container"));const t=h(".chatway--trigger-container"),i=this.makeCloseIcon(),s=this.makeSingleTextBubbleContainer(),r=this.makeMessagePreviewContainer();return e.innerHTML=`
      ${i.outerHTML}
      ${s.outerHTML}
      ${r.outerHTML}
    `,t.appendChild(e),e.addEventListener("click",o=>{this.executePreviewContainerClick(o)}),e}executePreviewContainerClick(e){var i;const t=(i=e.target)==null?void 0:i.classList;t&&t.contains("chatway--preview-link-container")?(new L().hidePreview(),new p().setBubbleExpiration()):new m().openWidget()}makeMultipleTextBubbleContainer(){const e=a.triggerData.is_preview_text_enabled,t=document.createElement("div");t.classList.add("chatway--text-bubble-container");const i=document.createElement("div");i.classList.add("chatway--preview-agents-container");const s=document.createElement("div");s.classList.add("chatway--preview-status-container");const r=document.createElement("div");return r.classList.add("chatway--preview-text-container"),t.appendChild(i),e&&t.appendChild(r),t.appendChild(s),t}makeSingleTextBubbleContainer(){const e=a.triggerData.is_preview_text_enabled,t=document.createElement("div");t.classList.add("bubble-container");const i=document.createElement("div");i.classList.add("imageOnlineStatus");const s=document.createElement("div");s.classList.add("agentDetailsText");const r=document.createElement("div");r.classList.add("agentDetailsName");const o=document.createElement("div");return o.classList.add("agentDetailsContent"),t.appendChild(i),t.appendChild(s),s.appendChild(r),e&&s.appendChild(o),t}makeMessagePreviewContainer(){const e=document.createElement("div");e.classList.add("chatway--message-preview-container");const t=document.createElement("div");t.classList.add("img-container");const i=document.createElement("div");i.classList.add("text-container");const s=document.createElement("div");s.classList.add("agent-name");const r=document.createElement("div");return r.classList.add("agent-message"),i.appendChild(s),i.appendChild(r),e.appendChild(t),e.appendChild(i),e}displayMultipleAgents(){var o;const e=h(".chatway--preview-agents-container");if(!e||!((o=a.agents)!=null&&o.length))return null;const t=a.triggerData.avatar_border_color,i=a.triggerData.header_text_color,s=[...a.agents].map(l=>`<div>
          ${l.attributes.profile_photo_url?`<img alt='agent image' src="${l.attributes.profile_photo_url}" style="border-color: ${t}" />`:`<div class='thumbnail-wrap'>
              <div class='thumbnail' style="border-color: ${t}">
                <span style="color: ${i}">${P(l.attributes.name)}</span>
              </div>
            </div>`}
          </div>`);s.push('<span class="chatway--preview-status-icon-container"></span>');const r=s.join("");return e.innerHTML=r,e}displaySingleAgent(){var o;const e=h(".imageOnlineStatus");if(!e||!((o=a.agents)!=null&&o.length))return this.hidePreview(),null;const t=a.agents[0].attributes,i=a.triggerData.avatar_border_color,s=a.triggerData.header_text_color,r=`
        ${t.profile_photo_url?`<img alt='agent image' src="${t.profile_photo_url}" style="border-color: ${i}" />`:`<div class='nameInitials' style="border-color: ${i}; color: ${s}">
            ${P(t.name)}
          </div>`}
          <span class="${a.status}"></span>`;return e.innerHTML=r,e}makePreviewText(){var s;const e=a.agents&&((s=a.agents)==null?void 0:s.length)>1?h(".chatway--preview-text-container"):h(".agentDetailsContent"),t=a.triggerData.is_preview_text_enabled,i=a.previewText;return!e||!t||!i?null:(le(i)&&h(".chatway--preview-container").classList.add("rtl"),e.textContent=i,e)}makeNameText(){var t;const e=h(".agentDetailsName");return!e||((t=a.agents)==null?void 0:t.length)!=1?null:(e.textContent=a.agents[0].attributes.name,e)}toggleOnlineStatus(){const e=h(".chatway--preview-agents-container");if(!e)return null;const t=a.status;return e.classList.remove("online","offline"),e.classList.add(t),e}makeCloseIcon(){const e=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M12 4L4 12" stroke="#93939D" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M4 4L12 12" stroke="#93939D" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    `,t=document.createElement("div");return t.classList.add("chatway--preview-link-container"),t.innerHTML=e,t.addEventListener("click",i=>{i.preventDefault(),this.hidePreview(),new p().setBubbleExpiration()}),t}showPreview(){var i;const e=h(".chatway--preview-container"),t=new _().isWidgetVisible;!e||t||(i=a.agents)!=null&&i.length&&a.triggerData.is_preview_text_enabled&&a.previewText&&e.classList.add("opened","show--text-bubble")}hidePreview(){const e=h(".chatway--preview-container");e&&e.classList.remove("opened","show--text-bubble","show--message-preview")}togglePreview(){const e=h(".chatway--preview-container");e&&e.classList.toggle("opened")}showUnreadMessage(){var w,C,k,Q,ee;if(!a.agentMessage)return;let e=h(".chatway--preview-container");const t=new _().isWidgetVisible;if(!e||t)return;e.classList.remove("show--text-bubble");const i=(w=a.agentMessage)==null?void 0:w.agent.attributes,s=h(".chatway--message-preview-container .img-container");i!=null&&i.profile_photo_url?(s.classList.remove("initials-container"),s.classList.add("image-container")):(s.classList.remove("image-container"),s.classList.add("initials-container"));const r=h(".chatway--message-preview-container .agent-name"),o=h(".chatway--message-preview-container .agent-message"),l=a.triggerData.avatar_border_color,c=a.triggerData.header_text_color;s.innerHTML=`
      ${i!=null&&i.profile_photo_url?`<img alt='agent image' src="${i==null?void 0:i.profile_photo_url}" style="border-color: ${l}" />`:`<div class='thumbnail' style="border-color: ${l}">
            <span style="color: ${c}">${P(i==null?void 0:i.name)}</span>
          </div>`} 
          <span class="${a.status}"></span>`,r.innerText=i==null?void 0:i.name;const d=(C=a.agentMessage)!=null&&C.message_html?(k=a.agentMessage)==null?void 0:k.message_html:(Q=a.agentMessage)==null?void 0:Q.message;o.innerHTML=((ee=a.agentMessage)==null?void 0:ee.type)=="text"?d:"Image received!",e.classList.add("opened","show--message-preview")}get isPreviewVisible(){const e=h(".chatway--preview-container");return e?e.classList.contains("opened"):!1}}class de{removePendingStatus(){const e=h("#chatway_widget_trigger");e&&e.classList.add("has-unread-message");const t=z(".Chatway-channel-link, .csaas-widget-trigger.has-chatway-channel");t&&t.forEach(i=>{i.classList.add("has-unread-message")})}updatePendingStatus(){const e=h("#chatway_widget_trigger");if(!e)return;const t=a.pageTitle,i=a.unReadCount,s=a.isWidgetVisible;!s||i==0?(document.title=t,e.classList.remove("has-unread-message")):(document.title=`(${i}) ${t}`,e.classList.add("has-unread-message")),e.setAttribute("data-unread-message",String(i));const r=z(".Chatway-channel-link, .csaas-widget-trigger.has-chatway-channel");r&&r.forEach(o=>{!s||i==0?(document.title=t,o.classList.remove("has-unread-message")):(document.title=`(${i}) ${t}`,o.classList.add("has-unread-message")),o.setAttribute("data-unread-message",String(i))})}}var u=(n=>(n.widgetToggle="widget.toggle",n.widgetLoaded="widget.loaded",n.widgetMetaData="widget.metadata",n.agentStatusChange="agent.status.change",n.unreadMessage="messages.unread",n.locationChange="location.change",n.agentMessaged="agent.messages.received",n.visitorConversationStarted="visitor.conversation.started",n.loadImage="load.image",n.removeImage="remove.image",n.profileData="profile.data",n.chatHistory="chat.history",n.focusEvent="focus.event",n.widgetReload="widget.reload",n.widgetDestroy="widget.destroy",n.customData="custom.data",n.removeToken="remove.token",n.chatContactLoaded="chat.contact.loaded",n.customerDataLoaded="customer.data.loaded",n.setVisitorEmail="set.visitor.email",n.openContactChannel="open.contact.channel",n.copyToClipboard="copy.to.clipboard",n))(u||{});class W extends Event{constructor(e={}){super("urlchangeevent",{cancelable:!0,...e}),this.newURL=e.newURL,this.oldURL=e.oldURL,this.action=e.action}get[Symbol.toStringTag](){return"UrlChangeEvent"}}const ge=window.history.pushState.bind(window.history);window.history.pushState=function(n,e,t){const i=new URL(t||"",window.location.href);window.dispatchEvent(new W({newURL:i,oldURL:I,action:"pushState"}))&&(ge({_index:E+1,...n},e,t),B())};const q=window.history.replaceState.bind(window.history);window.history.replaceState=function(n,e,t){const i=new URL(t||"",window.location.href);window.dispatchEvent(new W({newURL:i,oldURL:I,action:"replaceState"}))&&(q({_index:E,...n},e,t),B())};let I,E;function G(){const n=window.history.state;(!n||typeof n._index!="number")&&q({_index:window.history.length,...n},null,null)}function B(){I=new URL(window.location.href),E=window.history.state._index}G(),B(),window.addEventListener("popstate",function(n){G();const e=window.history.state._index,t=new URL(window.location);if(e===E){n.stopImmediatePropagation();return}if(!window.dispatchEvent(new W({oldURL:I,newURL:t,action:"popstate"}))){n.stopImmediatePropagation(),window.history.go(E-e);return}B()}),window.addEventListener("beforeunload",function(n){if(!window.dispatchEvent(new W({oldURL:I,newURL:null,action:"beforeunload"}))){n.preventDefault();const t="o/";return n.returnValue=t,t}});class X{constructor(e){g(this,"src","");this.src=e}openImageViewer(){const e=this.makeViewerContainer();document.body.appendChild(e),this.animateContainer()}closeImageViewer(){var e;(e=h(".chatway--image-viewer-container"))==null||e.remove()}makeViewerContainer(){const e=document.createElement("div"),t=document.createElement("div");t.classList.add("chatway--image--container");const i=this.makeImage();i.addEventListener("load",()=>{e.classList.add("chatway--image--loaded")});const s=this.makeCloseButton();return t.appendChild(i),t.appendChild(s),e.classList.add("chatway--image-viewer-container"),e.appendChild(t),e.addEventListener("click",r=>{r.target!==i&&this.closeImageViewer()}),e}makeImage(){const e=new Image;return e.src=this.src,e.classList.add("chatway--image-viewer-image"),e}convertStringToElement(e){return new DOMParser().parseFromString(e,"image/svg+xml").documentElement}makeCloseButton(){const e=document.createElement("a");return e.href="#",e.classList.add("dismiss--button"),e.appendChild(this.convertStringToElement(`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"  class="" style="" focusable="false" role="presentation" tabindex="-1">
                            <path d="M12 4L4 12" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M4 4L12 12" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>`)),e.addEventListener("click",i=>{i.preventDefault(),this.closeImageViewer()}),e}animateContainer(){setTimeout(()=>{var e;(e=h(".chatway--image-viewer-container"))==null||e.classList.add("enter-active")},150)}}var K;(function(n){n.fatal="fatal",n.error="error",n.warning="warning",n.log="log",n.info="info",n.debug="debug",n.critical="critical"})(K||(K={}));const he=/^\s*at (?:(.*?) ?\()?((?:file|https?|blob|chrome-extension|address|native|eval|webpack|<anonymous>|[-a-z]+:|.*bundle|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,ue=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:file|https?|blob|chrome|webpack|resource|moz-extension).*?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js))(?::(\d+))?(?::(\d+))?\s*$/i,we=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,M="?",pe="X-Sentry-Auth",me=/^(?:(\w+):)\/\/(?:([\w-]+)(?::(\w+))?@)([\w.-]+)(?::(\d+))?\/(.+)/;function fe(n){if(!n.stack)return null;const e=[],t=n.stack.split(`
`);let i,s;for(let r=0;r<t.length;++r){if(i=he.exec(t[r]))s={filename:i[2]&&i[2].indexOf("address at ")===0?i[2].substr(11):i[2],function:i[1]||M,lineno:i[3]?+i[3]:null,colno:i[4]?+i[4]:null};else if(i=we.exec(t[r]))s={filename:i[2],function:i[1]||M,lineno:+i[3],colno:i[4]?+i[4]:null};else if(i=ue.exec(t[r]))r===0&&!i[5]&&n.columnNumber!==void 0&&(e[0].column=n.columnNumber+1),s={filename:i[3],function:i[1]||M,lineno:i[4]?+i[4]:null,colno:i[5]?+i[5]:null};else continue;!s.function&&s.lineno&&(s.function=M),e.push(s)}return e.length?{value:Z(n),type:n.name,stacktrace:{frames:e.reverse()}}:null}function Z(n){return(n&&n.message||"No error message").split(`
`).filter(t=>!!t)[0]}function ye(n){try{const e=fe(n);if(e)return e}catch{}return{value:Z(n),type:n&&n.name,stacktrace:{frames:[]}}}function Ce(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)})}class be{constructor(e){if(e&&e.dsn){const t=me.exec(e.dsn),i=t?t.slice(1):[],s=i[5].split("/"),r=s.slice(0,-1).join("/");this.apiUrl=i[0]+"://"+i[3]+(i[4]?":"+i[4]:"")+(r?"/"+r:"")+"/api/"+s.pop()+"/store/",this.authHeader="Sentry sentry_version=7,sentry_key="+i[1]+(i[2]?",sentry_secret="+i[2]:"")}this.environment=e&&e.environment}prepare(e){return{...this.getRequestBlank(),exception:{values:[ye(e)]}}}report(e){this.send(this.prepare(e))}send(e){!this.apiUrl||!e||this.createRequest(e)}createRequest(e){const t=new XMLHttpRequest;t.open("POST",this.apiUrl,!0),t.setRequestHeader("Content-type","application/json"),t.setRequestHeader(pe,this.authHeader||""),t.send(JSON.stringify(e))}getRequestBlank(){return{platform:"javascript",event_id:Ce(),sdk:{name:"micro-sentry.javascript.core",version:"0.0.0"},timestamp:Date.now()/1e3,environment:this.environment}}}function Y(n,e){return Object.prototype.toString.call(e)==="[object RegExp]"?e.test(n):typeof e=="string"?n.indexOf(e)!==-1:!1}function ve(){return window}class U extends be{constructor(e,t=ve()){super(e),this.options=e,this.window=t,this.destroyed=!1,this._state={};const{plugins:i=[],beforeSend:s=d=>d,beforeBreadcrumb:r=d=>d,blacklistUrls:o=[],ignoreErrors:l=[],release:c=void 0}=this.options||{};this.plugins=i.map(d=>new d(this)),this.beforeSend=s,this.beforeBreadcrumb=r,this.blacklistUrls=o,this.ignoreErrors=l,this.release=c}get state(){return this._state}clearState(){this._state={}}setTags(e){return this.setKeyState("tags",{...e}),this}setTag(e,t){return this.extendState({tags:{[e]:t}}),this}setExtra(e,t){return this.extendState({extra:{[e]:t}}),this}setExtras(e){return this.setKeyState("extra",{...e}),this}setUser(e){return this.setKeyState("user",{...e}),this}clone(){const e=new U({...this.options,plugins:[]});return e.extendState(this.state),e}withScope(e){const t=this.clone();e(t),t.destroy(),this.setBreadcrumbs(void 0)}addBreadcrumb(e){this.extendState({breadcrumbs:[{timestamp:Date.now()/1e3,...this.beforeBreadcrumb(e)}]})}setBreadcrumbs(e){this.setKeyState("breadcrumbs",e)}captureMessage(e,t){this.send({...this.getRequestBlank(),message:e,level:t})}destroy(){this.destroyed=!0,this.plugins.forEach(e=>{e.destroy&&e.destroy()})}isIgnoredError(e){return this.ignoreErrors.length?this.getPossibleEventMessages(e).some(t=>this.ignoreErrors.some(i=>Y(t,i))):!1}getRequestBlank(){return{request:{url:this.window.location.toString(),headers:{"User-Agent":this.window.navigator.userAgent}},...super.getRequestBlank(),sdk:{name:"micro-sentry.javascript.browser",version:"0.0.0"},...this.state}}send(e){this.destroyed||this.isDeniedUrl(e)||this.isIgnoredError(e)||(super.send(this.beforeSend({release:this.release,...e})),this.setBreadcrumbs(void 0))}getPossibleEventMessages(e){if(e.message)return[e.message];if(e.exception)try{const{type:t="",value:i=""}=e.exception.values&&e.exception.values[0]||{};return[`${i}`,`${t}: ${i}`]}catch{return[]}return[]}isDeniedUrl(e){if(!this.blacklistUrls.length)return!1;const t=this.getEventFilterUrl(e);return t?this.blacklistUrls.some(i=>Y(t,i)):!1}getEventFilterUrl(e){try{if(e.exception){const t=e.exception.values&&e.exception.values[0].stacktrace&&e.exception.values[0].stacktrace.frames;return t&&t[t.length-1].filename||null}return null}catch{return null}}extendState(e){this._state=Object.keys(e).reduce((t,i)=>{const s=this._state[i],r=Array.isArray(s)?s:null,o=e[i],l=Array.isArray(o)?o:null;return{...t,[i]:r||l?[...r||[],...l||[]]:{...typeof s!="string"?s:{},...typeof o!="string"?o:{}}}},this._state)}setKeyState(e,t){this._state[e]=t}}class f{init(){new U({dsn:"",ignoreErrors:["Failed to fetch","NetworkError when attempting to fetch resource.","Property description must be an object.","No error message","App container not found","JSON.parse: unexpected","Unexpected token","The string did not match the expected pattern."]})}logError(e){}}const D=()=>{const n="https://prod-api.chatway.app/api/widget/",e={headers:{"Content-Type":"application/json",Accept:"application/json"}};function t(l,c){return fetch(n+l,{...e,...c,method:"get"})}function i(l,c,d){return fetch(n+l,{...e,...d,body:JSON.stringify(c),method:"post"})}function s(l,c,d){return fetch(n+l,{...e,...d,body:JSON.stringify(c),method:"put"})}function r(l,c,d){return fetch(n+l,{...e,...d,body:JSON.stringify(c),method:"PATCH"})}function o(l,c,d){return fetch(n+l,{...e,...d,body:JSON.stringify(c),method:"DELETE"})}return{post:i,get:t,put:s,patch:r,delete:o}};class S{addCustomData({token:e,name:t,value:i}){return D().post("chat-contacts/custom-fields",{name:t,value:i},{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json",Accept:"application/json"}})}deleteCustomData({token:e,name:t}){return D().delete("chat-contacts/custom-fields",{name:t},{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json",Accept:"application/json"}})}updateEmailName({token:e,name:t,value:i}){return D().patch("chat-contacts/profile",{[t]:i},{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json",Accept:"application/json"}})}deleteEmailName({token:e,name:t}){return D().patch("chat-contacts/profile",{remove:t},{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json",Accept:"application/json"}})}addTag({token:e,tags:t}){return D().post("chat-contacts/tags",{tags:t},{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json",Accept:"application/json"}})}deleteTag({token:e,tags:t}){return D().delete("chat-contacts/tags",{tags:t},{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json",Accept:"application/json"}})}assignShopifyCustomer(e){return fetch(`${e.marketplace_origin}/apps/chatway-app-proxy/chat-contacts/${e.chat_contact_id}/assign-customer-id`,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}})}getShopifyCustomerData(e){return fetch(`${e.marketplace_origin}/apps/chatway-app-proxy/logged-in-customer-id`,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}})}saveShopifyCartData({token:e,chat_contact_id:t,shopify_cart:i}){return fetch(`https://prod-api.chatway.app/api/pixel/chat-contacts/${t}/cart-info`,{method:"PATCH",body:JSON.stringify({shopify_cart:i}),headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json",Accept:"application/json"}})}}class T{async updateChatwayCustomData(e,t){try{if(!e||!t)return;const i=new p().getSessionToken();if(!i)return new m().dispatchEvent(u.customData,JSON.stringify({name:e,value:t,method:"updateChatwayCustomData"}));const s=new S;if(e.toLowerCase()==="email"||e.toLowerCase()==="name"||e.toLowerCase()==="phone"){const o=await s.updateEmailName({token:i,name:e,value:t}),{data:l}=await o.json();let c;return c={email:l.attributes.email,phone:l.attributes.phone},e==="name"&&(c={...c,name:l.attributes.name}),new m().actionDispatcher(u.profileData,c),{message:"Success"}}return(await s.addCustomData({token:i,name:e,value:t})).json()}catch(i){new f().logError(i)}}getContactId(){return a.chatContactId}getContactToken(){return new p().getSessionToken()}async removeChatwayCustomData(e){try{if(!e)return;const t=new p().getSessionToken();if(!t)return new m().dispatchEvent(u.customData,JSON.stringify({name:e,method:"removeChatwayCustomData"}));const i=new S;if(e.toLowerCase()==="email"||e.toLowerCase()==="name"||e.toLowerCase()==="phone"){const r=await i.deleteEmailName({token:t,name:e}),{data:o}=await r.json();let l;return l={email:o.attributes.email,phone:o.attributes.phone},e==="name"&&(l={...l,name:"remove"}),new m().actionDispatcher(u.profileData,l),o}return(await i.deleteCustomData({token:t,name:e})).json()}catch(t){console.log(t),new f().logError(t)}}hideChatwayIcon(){a.isHideChatwayIcon=!0;const e=document.getElementsByClassName("chatway--trigger-icon-container")[0];if(!e)return;e.classList&&e.classList.add("hide--chatway");let t=h(".chatway--preview-container");t!=null&&t.classList&&!a.agentMessage&&t.classList.add("hide--chatway");const i=a.userID,s=JSON.parse(sessionStorage.getItem(`ch_session_info_${i}`)||"{}");(s==null?void 0:s.widgetStatus)!=="open"&&new m().closeWidget()}showChatwayIcon(){a.isHideChatwayIcon=!1;const e=document.getElementsByClassName("chatway--trigger-icon-container")[0];if(!e)return;e.classList&&e.classList.remove("hide--chatway");let t=h(".chatway--preview-container");t!=null&&t.classList&&t.classList.remove("hide--chatway");const i=a.userID,s=JSON.parse(sessionStorage.getItem(`ch_session_info_${i}`)||"{}");(s==null?void 0:s.widgetStatus)!=="open"&&new m().closeWidget()}openChatwayWidget(){new m().openWidget()}closeChatwayWidget(){new m().closeWidget()}async addChatwayTags(e){try{if(!e)return;const t=new p().getSessionToken();if(!t)return new m().dispatchEvent(u.customData,JSON.stringify({tag:e,method:"addChatwayTags"}));const i=new S,s=Array.isArray(e)?e.map(o=>({name:o})):[{name:e}];return(await i.addTag({token:t,tags:s})).json()}catch(t){new f().logError(t)}}async removeChatwayTags(e){try{if(!e)return;const t=new p().getSessionToken();if(!t)return new m().dispatchEvent(u.customData,JSON.stringify({tag:e,method:"removeChatwayTags"}));const i=new S,s=Array.isArray(e)?e.map(o=>({name:o})):[{name:e}];return(await i.deleteTag({token:t,tags:s})).json()}catch(t){console.log(t),new f().logError(t)}}}const $=new class{async assignCustomer(){if(!A()||!a.chatContactId)return;const e={chat_contact_id:a.chatContactId,marketplace_origin:A()};try{const i=await(await new S().assignShopifyCustomer(e)).json();new m().dispatchEvent(u.setVisitorEmail,JSON.stringify(i))}catch(t){console.log(t)}}isShopifyCartURL(e){if(!e)return!1;const t=["/cart/add","/cart/change","/cart/clear","/cart/add.js","/cart/change.js","/cart/clear.js"],i=e.split("/").pop();return t.includes(`/cart/${i}`)}watchCartChange(){if(!window.fetch||typeof window.fetch!="function")return;const e=window.fetch,t=this;window.fetch=function(){const i=e.apply(this,arguments);return t.isShopifyCartURL(arguments[0])&&i.then(s=>{s.clone().json().then(r=>t.saveCartData(r))}),i}}async getCartData(){try{return await(await fetch(window.location.origin+window.Shopify.routes.root+"cart.js")).json()}catch(e){console.log(e)}}async saveCartData(e){const t=new p().getSessionToken(),i=e!=null&&e.token?e:await this.getCartData();if(!t||!a.chatContactId||!i)return;const s={token:t,shopify_cart:i,chat_contact_id:a.chatContactId};try{await new S().saveShopifyCartData(s)}catch{}}async getCustomerData(){if(!A())return;const e={marketplace_origin:A()};try{const i=await(await new S().getShopifyCustomerData(e)).json();new m().dispatchEvent(u.customerDataLoaded,JSON.stringify(i))}catch(t){console.log(t),new m().dispatchEvent(u.customerDataLoaded,JSON.stringify({}))}}};class m{constructor(){g(this,"origin","https://widget.chatway.app/");g(this,"actionType","CHATWAY");g(this,"appContainer");g(this,"frameContainer");g(this,"bodyContainer");g(this,"triggerContainer");g(this,"iconToggler");this.appContainer=a.appContainer,this.bodyContainer=document.getElementsByTagName("body")[0]?document.getElementsByTagName("body")[0]:null,this.frameContainer=a.frameContainer,this.triggerContainer=a.triggerContainer,this.iconToggler=a.iconToggler}setupEvents(){window.addEventListener("message",this.messageCallback.bind(this),!1),window.addEventListener("urlchangeevent",this.urlChangeCallback.bind(this),!1)}cleanupEvents(){var e;(e=this.iconToggler)==null||e.removeEventListener("click",()=>{this.actionDispatcher(u.widgetToggle)}),window.removeEventListener("message",this.messageCallback.bind(this),!1),window.removeEventListener("urlchangeevent",this.urlChangeCallback.bind(this),!1)}async actionDispatcher(e,t=null){switch(e){case u.widgetToggle:this.toggleWidget();break;case u.widgetDestroy:new N().destroyApp();break;case u.widgetReload:new p().deleteUserConfig(),new N().destroyApp(),a.isChatInitialized="false",a.token="",await ae(300),new N().initialize();break;case u.agentStatusChange:const i=a.previewTextBubbleDelay*1e3;setTimeout(()=>{this.toggleTextBubble({agentDetails:t,isNewMessage:!1,isStatusChange:!0})},i);break;case u.unreadMessage:this.handleUnread(t);break;case u.agentMessaged:this.handleIncomingMessage(t);break;case u.visitorConversationStarted:this.setVisitorID(t);break;case u.loadImage:this.loadImage(t);break;case u.removeImage:this.removeImage();break;case u.widgetLoaded:this.sendChatHistoryData(),this.sendWidgetData(),this.runConfigChecks(),this.emitIconState(),R()=="shopify"&&$.getCustomerData();break;case u.profileData:this.setProfileData(t);break;case u.focusEvent:this.handleFocusEvent();break;case u.customData:this.saveCustomData(t);break;case u.removeToken:new p().deleteUserConfig();break;case u.chatContactLoaded:a.chatContactId=this.getContactId(t),R()=="shopify"&&($.assignCustomer(),$.saveCartData(),$.watchCartChange());break;case u.openContactChannel:this.openContactChannel(t);break;case u.copyToClipboard:this.copyToClipboard(t);break}}saveCustomData(e){if(!new p().getSessionToken()||!e)return;const s=JSON.parse(e);switch(s.method){case"updateChatwayCustomData":new T().updateChatwayCustomData(s.name,s.value);break;case"removeChatwayCustomData":new T().removeChatwayCustomData(s.name);break;case"addChatwayTags":new T().addChatwayTags(s.tag);break;case"removeChatwayTags":new T().removeChatwayTags(s.tag);break}}addIconEvent(){this.iconToggler.addEventListener("click",()=>{this.actionDispatcher(u.widgetToggle)})}messageCallback(e){e.data.type&&e.data.type==this.actionType&&this.actionDispatcher(e.data.action,e.data.meta)}urlChangeCallback(e){try{if(e.action=="popstate"&&x()&&(e.preventDefault(),this.closeWidget(),window.history.pushState(null,"",window.location.href)),e.action=="pushState"&&e.oldURL.href!=e.newURL.href){const t=u.locationChange,i={origin:e.newURL.origin,path:e.newURL.pathname};this.dispatchEvent(t,JSON.stringify(i))}}catch(t){new f().logError(t)}}toggleWidget(){new _().isWidgetVisible?this.closeWidget():this.openWidget()}closeWidget(){if(new _().isWidgetVisible){j(this.appContainer,"widget--open"),j(this.bodyContainer,"chatway-is-open"),this.emitIconState(),(window.innerWidth<601||sessionStorage.getItem("_bdyF"))&&oe(),new p().setWidgetStatus(!1);let t={data:"false",expireTime:Date.now()+1*60*60*1e3};localStorage.setItem("showTextBubble",JSON.stringify(t)),window.removeEventListener("popstate",this.urlChangeCallback.bind(this),!1)}}findAttentionEffectClass(e){const t=/\S*effect\S*/,i=e==null?void 0:e.className.match(t);return i?i[0]:""}openWidget(){const e=new _().isWidgetVisible,t=document.getElementsByClassName("chatway-launcher")[0]||null;if(t&&this.findAttentionEffectClass(t)&&(t.classList&&t.classList.remove(this.findAttentionEffectClass(t)),new p().setShowAttentionEffect(!1)),window.history.pushState({page:"widget"},"",window.location.href),window.addEventListener("popstate",this.urlChangeCallback.bind(this),!1),!e){V(this.appContainer,"widget--open"),V(this.bodyContainer,"chatway-is-open");const i=new L;i.isPreviewVisible&&i.hidePreview(),ne(),window.innerWidth<=601&&re(),this.emitIconState(),new p().setWidgetStatus(!0),new p().setBubbleExpiration()}}emitIconState(){if(this.appContainer){const e=u.widgetToggle,t=new _().isWidgetVisible;let i={isOpen:!1};t&&(i.isOpen=!0),this.dispatchEvent(e,JSON.stringify(i))}}sendChatHistoryData(){const e=ce("res_chtwy_cht");if(e){const t=u.chatHistory,i={res_chtwy_cht:e};this.dispatchEvent(t,JSON.stringify(i))}}sendWidgetData(){const e=u.widgetLoaded,t=a.triggerData,i=a.widgetID,s=a.userID,r=new p,o={"bg-color":t.widget_color,"icon-color":O(t.widget_color),isMobileDevice:x(),userId:s,widgetId:i,origin:location.origin,marketplace:R(),path:location.pathname,agents:a.allAgents,previewText:a.previewText,token:r.getSessionToken(),isChatInitialized:r.getChatInitStatus(),browserData:a.browserData,...t};this.dispatchEvent(e,JSON.stringify(o))}runConfigChecks(){new p().wasWidgetOpen&&this.toggleWidget()}dispatchEvent(e,t=null){var i;try{const s=h("#chatway_widget_app"),r={type:"CHATWAY",action:e,meta:t};if(!s||s.contentWindow===null)return;(i=s.contentWindow)==null||i.postMessage(r,"*")}catch(s){new f().logError(s)}}toggleTextBubble(e){const t=new p,i=JSON.parse(e.agentDetails);if(a.agents=i,!a.triggerData.is_preview_text_enabled||t.showTextBubble==="false"&&!e.isNewMessage||a.isHideChatwayIcon&&e.isStatusChange)return;a.status=i.some(r=>r.attributes.online_status.toLowerCase()=="online")?"online":"offline";const s=new L;a.agents&&a.agents.length>1?s.makeMultipePreviewContainer():s.makeSinglePreviewContainer(),a.agents&&a.agents.length>1?s.displayMultipleAgents():s.displaySingleAgent(),s.makePreviewText(),s.makeNameText(),s.toggleOnlineStatus(),s.showPreview(),t.setTextBubbleStatus(!0)}handleUnread(e){const t=JSON.parse(e);a.unReadCount=parseInt(t.count),new de().updatePendingStatus()}handleIncomingMessage(e){a.agentMessage=JSON.parse(e);const t=JSON.stringify(a.agents),i=a.userID,s=JSON.parse(sessionStorage.getItem(`ch_session_info_${i}`)||"{}");(s==null?void 0:s.widgetStatus)!=="open"&&this.toggleTextBubble({agentDetails:t,isNewMessage:!0,isStatusChange:!1});const r=new L;let o=h(".chatway--preview-container");o!=null&&o.classList&&o.classList.remove("hide--chatway"),r.showUnreadMessage()}setVisitorID(e){const t=JSON.parse(e),i=new p;a.token=t.token,a.isChatInitialized=t.isChatInitialized,i.setSessionToken(t.token),i.setChatInitStatus(t.isChatInitialized)}getContactId(e){return e?JSON.parse(e).contactId:""}setProfileData(e){const t=u.profileData;this.dispatchEvent(t,JSON.stringify(e))}handleFocusEvent(){this.closeWidget()}loadImage(e){const{src:t}=JSON.parse(e);new X(t).openImageViewer()}removeImage(){new X("").closeImageViewer()}checkPageRules(){const e=a.pageRules;if(!(e!=null&&e.is_enable)){this.toggleWidgetVisibility(!0);return}const t=this.removeSlashFromUrl(window.location.href.replace(window.location.origin,"")),i=this.cleanDomain(window.location.host),s=this.checkForPageRules(i,t,e.rules,"show",!0),r=this.checkForPageRules(i,t,e.rules,"hide",!1);this.toggleWidgetVisibility(s&&r)}checkForPageRules(e,t,i,s,r){let o=!1,l=!r;for(const c of i){const d=this.cleanDomain(this.removeSlashFromUrl(c.domain)),w=this.removeSlashFromUrl(c.page);e===d&&c.visibility==s&&(o=!0,(c.condition==="any-page"||c.condition==="contains"&&t.includes(w)||c.condition==="equals"&&t===w||c.condition==="start-with"&&t.startsWith(w)||c.condition==="end-with"&&t.endsWith(w)||c.condition==="homepage"&&t==="")&&(l=r))}return o?l:!0}cleanDomain(e){return e.replace(/^(https?:\/\/)?(www\.)?/,"")}removeSlashFromUrl(e){return e.endsWith("/")&&(e=e.slice(0,-1)),e.startsWith("/")&&(e=e.replace("/","")),e}toggleWidgetVisibility(e){const t=h(".chatway--container"),i=h("body");!t||!i||(e?(t.classList.remove("hide--widget"),i.classList.add("chatway--active")):(t.classList.add("hide--widget"),i.classList.remove("chatway--active")))}checkVisibilityRules(){var d,w;const e=h(".chatway--container");if(!e)return;const t=a.visibilityHours;if(a.visibilityHourTimezone==null||!t.length){a.isWidgetVisible=!0,this.checkForTriggers();return}const i=new Date,s=new Date(i.toLocaleString("en-US",{timeZone:a.visibilityHourTimezone})),r=i.getDay(),l=(d=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][r])==null?void 0:d.toLowerCase();let c=!1;for(const C of t){const k=this.timeWithinRange(s,C.start_time,C.end_time);if(C.is_custom&&C.custom_date===s.toISOString().slice(0,10)&&(c=C.is_published?k:!k,k))break;C.is_published&&((w=C.day)==null?void 0:w.toLowerCase())===l&&k&&(c=!0)}a.isWidgetVisible=c,c?this.checkForTriggers():e.style.display="none"}displayWidget(){const e=h(".chatway--container");e!==null&&e.classList.add("has-loaded"),localStorage.setItem("isWidgetVisible","true")}checkForTriggers(){const{is_trigger_enabled:e,has_display_after_time:t,has_display_page_scroll:i,display_after_time:s,display_page_scroll:r}=a.widgetTriggers;if(localStorage.getItem("isWidgetVisible")==="true"||!e){this.displayWidget();return}if(!t&&!i){this.displayWidget();return}t&&setTimeout(()=>this.displayWidget(),1e3*s),i&&(document.body.scrollHeight>window.innerHeight?window.onscroll=()=>{Math.ceil(window.scrollY/(document.documentElement.scrollHeight-window.innerHeight)*100)>=r&&this.displayWidget()}:this.displayWidget())}timeWithinRange(e,t,i){const s=new Date(`${e.toDateString()} ${t}`),r=new Date(`${e.toDateString()} ${i}`);return e>=s&&e<=r}openContactChannel(e){if(e)try{const{channelUrl:t,target:i}=JSON.parse(e);window.open(t,i)}catch(t){new f().logError(t)}}copyToClipboard(e){if(e)try{const{text:t}=JSON.parse(e);navigator.clipboard.writeText(t)}catch(t){new f().logError(t)}}}class _e{constructor(e,t,i){this.widgetIcon=e,this.widgetColor=t,this.widgetImage=i}getChatIcon(){let e=null;switch(!0){case this.widgetIcon=="chat-base":e=this.chatBase;break;case this.widgetIcon=="chat-smile":e=this.chatSmile;break;case this.widgetIcon=="chat-bubble":e=this.chatBubble;break;case this.widgetIcon=="chat-db":e=this.chatDb;break;case this.widgetIcon=="chat-image":e=this.chatImage;break;default:e="";break}return this.widgetIcon=="chat-image"?this.parseImage(e):this.convertStringToElement(e)}hasCustomImage(){return this.widgetIcon=="chat-image"}getCloseIcon(){return this.convertStringToElement(this.closeIcon)}convertStringToElement(e){const i=new DOMParser().parseFromString(e,"image/svg+xml"),s=i.querySelectorAll(".fill--element");return s.length>0&&s.forEach(r=>r.setAttribute("fill",this.widgetColor)),i.documentElement}parseImage(e){return new DOMParser().parseFromString(e,"text/html").querySelector("img")}get chatBase(){return`
    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
	    <path fill-rule="evenodd" clip-rule="evenodd" d="M10.7322 5H24.5989C26.2878 5 27.71 6.42222 27.6211 8.11111V24.1111C27.6211 24.4667 27.4433 24.7334 27.1767 24.9111H26.91C26.5544 24.9111 26.4655 24.9111 26.2878 24.7333L24.5989 23.0444V12.7333C24.5989 10.1556 22.5544 8.11111 19.9766 8.11111H7.62109C7.62109 6.42222 9.04332 5 10.7322 5ZM6.11111 9.62305H19.9778C21.6667 9.62305 23.0889 11.0453 23.0889 12.7342V28.9119C23.0889 29.2675 22.9111 29.5341 22.6444 29.7119H22.3778C22.0222 29.7119 21.9333 29.7119 21.7556 29.5341L17.3111 25.0897H6.11111C4.42222 25.0897 3 23.6675 3 21.9786V12.7342C3 11.0453 4.42222 9.62305 6.11111 9.62305Z" fill="white" />
    </svg>
    `}get chatBubble(){return`
    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
	    <path d="M13.2222 4H17.9333C20.6 4 23.2667 5.06669 25.1333 7.02224C27 8.88891 28.1556 11.5556 28.1556 14.2222C28.1556 19.5556 24.0667 24 18.7333 24.4444V28.3556C18.7333 28.7111 18.5556 28.9778 18.2889 29.1556C18.1111 29.1556 18.1111 29.1556 17.9333 29.1556C17.7556 29.1556 17.4889 28.9778 17.3111 28.8L13.2222 24.3556C10.5556 24.3556 7.88888 23.2889 6.02222 21.3333C4.15555 19.3778 3 16.8 3 14.1334C3 8.53335 7.62222 4 13.2222 4ZM21.8445 15.7333C22.8222 15.7333 23.4444 15.1111 23.4444 14.1334C23.4444 13.1556 22.8222 12.5334 21.8445 12.5334C20.8667 12.5334 20.2444 13.1556 20.2444 14.1334C20.3333 15.1111 20.9556 15.7333 21.8445 15.7333ZM15.6222 15.7333C16.6 15.7333 17.2222 15.1111 17.2222 14.1334C17.2222 13.1556 16.6 12.5334 15.6222 12.5334C14.6445 12.5334 14.0222 13.1556 14.0222 14.1334C14.0222 15.1111 14.6445 15.7333 15.6222 15.7333ZM9.31112 15.7333C10.2889 15.7333 10.9111 15.1111 10.9111 14.1334C10.9111 13.1556 10.2889 12.5334 9.31112 12.5334C8.33334 12.5334 7.71113 13.1556 7.71113 14.1334C7.71113 15.1111 8.33334 15.7333 9.31112 15.7333Z" fill="white" />
    </svg>
`}get chatDb(){return`
    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M26.2889 4H6.2889C4.42223 4 3 5.51112 3 7.2889V18.9333C3 20.8 4.51112 22.2222 6.2889 22.2222H23.4444L28.2445 27.0222C28.4222 27.2 28.6 27.2 28.8667 27.2C29.0444 27.2 29.0444 27.2 29.2222 27.2C29.5778 27.0222 29.7556 26.6667 29.7556 26.4V7.2889C29.5778 5.51112 28.0667 4 26.2889 4Z" fill="white"/>
      <path d="M11.1777 16.2662C13.4 17.244 18.7333 18.1329 22.7333 13.8662" stroke="#282D3E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M25.1328 13.7775C25.0439 12.7109 24.4217 10.7553 22.1995 11.2886" stroke="#282D3E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
`}get chatSmile(){return`
    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 1080 1080" style="enable-background:new 0 0 1080 1080;" xml:space="preserve">
<style type="text/css">
	.chtway0{fill-rule:evenodd;clip-rule:evenodd;fill:#FFFFFF;}
</style>
<path class="chtway0" d="M304,120.5c-88.4,0-160.1,71.7-160.1,160.1v417.3c0,88.4,71.7,160.1,160.1,160.1h96.6c23.1,0,45.1,10,60.3,27.4
	l55.2,63.2c12.6,14.5,35.1,14.5,47.7,0l55.2-63.2c15.2-17.4,37.2-27.4,60.3-27.4H776c88.4,0,160.1-71.7,160.1-160.1V280.6
	c0-88.4-71.7-160.1-160.1-160.1H304z M410.2,579.9c-21.6,0-44.4-0.1-44.4,17.5c0,69.1,74,156.8,158.4,156.8h31.7
	c84.5,0,158.4-87.7,158.4-156.8c0-17.6-22.8-17.5-44.4-17.5c-1,0-2.1,0-3.1,0H413.3C412.2,579.9,411.2,579.9,410.2,579.9z"/>
</svg>
    `}get chatImage(){return`<img class=""  src="${this.widgetImage}" alt="">`}get closeIcon(){return`
    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
	    <path d="M8 12L16 20L24 12" stroke="white" stroke-width="2.67" stroke-linecap="round" stroke-linejoin="round" />
    </svg>
  `}}class Se{constructor(){g(this,"_svgBuilder");g(this,"triggerData");this.triggerData=a.triggerData,this._svgBuilder=new _e(this.triggerData.widget_icon,O(this.triggerData.widget_color),this.triggerData.widget_icon_url)}makeIconContainer(){const e=document.createElement("div");return e.classList.add("chatway-launcher"),e.setAttribute("role","button"),e.setAttribute("aria-label","Open Chatway Messenger"),e.setAttribute("tabindex","0"),e.style.background=O(this.triggerData.widget_color),new p().getShowAttentionEffect()&&this.triggerData.default_state==="click"&&e.classList.add(this.triggerData.attention_effect+"-effect"),e}makeLauncherContainer(){const e=document.createElement("div");e.classList.add("launcher-icon"),e.classList.add("launcher-default-open-icon"),e.classList.add("launcher-default-open-animated");const t=this._svgBuilder.getChatIcon();return this._svgBuilder.hasCustomImage()&&e.classList.add("has-custom-image"),e.appendChild(t),e}makeAnimatedContainer(){const e=document.createElement("div");e.classList.add("launcher-icon"),e.classList.add("animatedIcon");const t=document.createElement("dotlottie-player");return t.setAttribute("src","https://lottie.host/6468be3e-a133-4b36-aba2-01a8014e8406/LoRT0NHpMO.json"),t.setAttribute("background","transparent"),t.setAttribute("speed","1"),t.setAttribute("style","width: inherit; height: inherit;"),t.setAttribute("loop","true"),t.setAttribute("autoplay","true"),e.appendChild(t),e}makeCloseContainer(){const e=document.createElement("div");e.classList.add("launcher-icon"),e.classList.add("launcher-minimize-icon");const t=this._svgBuilder.getCloseIcon();return e.appendChild(t),e}makeIcon(){const e=this.makeIconContainer(),t=this.makeLauncherContainer(),i=this.makeCloseContainer();return e.appendChild(t),e.appendChild(i),e}}const ke=n=>new Promise(function(e,t){var i=new XMLHttpRequest;i.open("GET",n,!0),typeof i.setRequestHeader=="function"&&(i.setRequestHeader("Content-Type","application/json"),i.setRequestHeader("Accept","application/json")),i.onload=function(){i.status==200?e(JSON.parse(i.responseText)):t("Error "+i.status+": "+i.statusText)},i.onerror=function(){t("Network error")},i.send()});class N{constructor(){g(this,"triggerData",null);g(this,"scriptId")}start(){this.isChatwayInstalled||(this.setupGlobalFunctions(),this.addWindowLoadEvent())}getEcwidShopID(){let e=0;return typeof window.Ecwid=="object"&&(e=window.Ecwid.getOwnerId()),e}async initialize(){if(!a.hasAlreadyLoaded)try{a.hasAlreadyLoaded=!0,this.removeWindowLoadEvent(),this.setCurrentUserId(),se(),await this.fetchWidgetData()&&(this.checkForChatyScript(),this.buildApp())}catch(e){new f().logError(e)}}addWindowLoadEvent(){document.readyState=="complete"?this.initialize():window.addEventListener&&window.addEventListener("load",()=>{this.initialize()},!0)}removeWindowLoadEvent(){window.removeEventListener("load",this.initialize)}setCurrentUserId(){var e,t;this.scriptId=F("chatway","id"),!this.scriptId&&((e=window.wpChatwaySettings)!=null&&e.widgetId)&&(this.scriptId=window.wpChatwaySettings.widgetId),!this.scriptId&&!((t=window.wpChatwaySettings)!=null&&t.widgetId)&&this.getEcwidShopID()&&(this.scriptId=this.getEcwidShopID().toString()),a.userID=this.scriptId}async fetchCloudFrontData(){try{return await(await fetch("https://www.cloudflare.com/cdn-cgi/trace",{method:"GET"})).text()}catch(e){console.log(e)}return""}async fetchWidgetData(){try{const e=await this.fetchCloudFrontData(),t=H(e).ip||"",i=H(e).loc||"",s=x()?1:0,r=F("chatway","id");let o="";a.browserData=H(e),!r&&this.getEcwidShopID()&&(o="ecwid");const l=`https://prod-api.chatway.app/api/pixel/widget?${!r&&this.getEcwidShopID()?"site_identifier":"user_identifier"}=${this.scriptId}&include[]=agents&include[]=faqs&ip=${t}&is_mobile=${s}&loc=${i}&channel=${o}`,{data:c,included:d}=await ke(l);if(!c)throw new Error(`No data returned from API for ${this.scriptId}`);const w=c.attributes;return w.hasOwnProperty("is_ch_ob")&&!w.is_ch_ob||w.is_blocked?!1:(this.triggerData=c.attributes,a.widgetID=c.id,a.triggerData=w,a.allAgents=d,a.pageTitle=document.title,a.visibilityHourTimezone=w.timezone,a.visibilityHours=this.setWidgetVisibilityHour(d),a.widgetTriggers=this.setWidgetTriggers(d),a.pageRules=this.setPageRules(w),this.setDevicePreferences(d),!0)}catch(e){throw console.log(e),new f().logError(e),e}}setDevicePreferences(e){if(!e)return;const t=e.filter(d=>d.type==="device_preferences"),i=a.triggerData,s=t.find(d=>d.attributes.is_mobile),r=t.find(d=>!d.attributes.is_mobile);if(s&&r)i.device_preferences={desktop:r.attributes,mobile:s.attributes};else{const d={position:i==null?void 0:i.position,custom_position_side:i==null?void 0:i.custom_position_side,bottom_spacing:i==null?void 0:i.bottom_spacing,side_spacing:i==null?void 0:i.side_spacing,custom_widget_size:i==null?void 0:i.custom_widget_size,is_preview_text_enabled:!!(i!=null&&i.is_preview_text_enabled),preview_text_bubble_delay:i==null?void 0:i.preview_text_bubble_delay,preview_text:i==null?void 0:i.preview_text,is_welcome_text_enabled:i==null?void 0:i.is_welcome_text_enabled,widget_size:i==null?void 0:i.widget_size};i.device_preferences={desktop:d,mobile:d}}if(!a.triggerData)return;let o=i.is_separate_device_preference&&x()?"mobile":"desktop";const l=i.device_preferences[o];Object.keys(l).forEach(d=>{a.triggerData[d]=l[d]}),a.previewText=this.getPreviewText(i.device_preferences[o].preview_text,e,o),a.previewTextBubbleDelay=i.device_preferences[o].preview_text_bubble_delay}setPageRules(e){var t,i;return e!=null&&e.has_paid_access&&((t=e==null?void 0:e.page_targeting)!=null&&t.is_enable)&&((i=e==null?void 0:e.page_targeting)==null?void 0:i.rules.length)>0?e==null?void 0:e.page_targeting:{is_enable:!1,rules:[]}}setWidgetTriggers(e){let t={is_trigger_enabled:!1,has_display_after_time:!1,display_after_time:0,has_display_page_scroll:!1,display_page_scroll:0};return e.forEach(i=>{i.type==="widget_trigger"&&(t=i.attributes)}),t}setWidgetVisibilityHour(e){const t=[];return e.forEach(i=>{i.type==="widget_visibility_hour"&&t.push(i.attributes)}),t}checkForChatyScript(){if(document.getElementById("pixel-chaty")){let e=document.getElementsByTagName("body")[0]?document.getElementsByTagName("body")[0]:null;e&&e.classList.add("has--chaty")}}async buildApp(){var e;try{const t=new _,i=await t.makeAppContainer();if(!i)throw new Error("App container not found");const s=t.makeFrameContainer();if(!s)throw new Error("Frame container not found");const r=t.makeTriggerContainer();if(!r)throw new Error("Trigger container not found");const l=new Se().makeIcon();r.appendChild(l),a.appContainer=i,a.frameContainer=s,a.triggerContainer=r,a.iconToggler=l;const c=new m;if(c.setupEvents(),c.addIconEvent(),c.emitIconState(),c.checkVisibilityRules(),setInterval(()=>{c.checkVisibilityRules()},6e4),c.checkPageRules(),(e=a.pageRules)!=null&&e.is_enable){let d=history.pushState;history.pushState=function(){d.apply(history,arguments),c.checkPageRules()}}}catch(t){new f().logError(t)}}setupGlobalFunctions(){window.$chatway=window.$chatway||new T}get isChatwayInstalled(){return window.$chatway!==void 0}async destroyApp(){const e=new m,t=new _;e.cleanupEvents(),e.closeWidget(),t.destroyAppContainer(),a.hasAlreadyLoaded=!1}getPreviewText(e,t,i){if(!t)return e;const s=t.filter(c=>c.type==="widget_langs");let r=navigator.language;r!=="zh-TW"&&(r=r.split("-")[0]);const o=s.find(c=>c.id===r);if(o)return o.attributes[`widget_text_bubble_${i}`];const l=s.find(c=>{var d;return(d=c.attributes)==null?void 0:d.is_default});if(l){const c=l.attributes[`widget_text_bubble_${i}`];return c!==e?e:c}return e}}new f().init(),new N().start()})();
